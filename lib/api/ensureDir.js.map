{"version":3,"sources":["src/ensureDir.js"],"names":[],"mappings":"yQAAsB,qBAAqB,wBACtB,UAAU,mDAE/B,IAAM,YAAY,CAAG,sBAAS,SAAS,yBAAS,CAAA,AAEhD,IAAM,YAAY,CAAG,SAAf,YAAY,CAAmB,IAAI,CAAE,UAAU,MAE3C,SAAS,6MAAS,YAAY,CAAC,MAAM,CAAE,CAAC,IAAI,CAAJ,IAAI,CAAC,CAAE,UAAU,CAAC,SAA1D,SAAS,yBACX,SAAS,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,CAAE,CAAC,CAAC,KAAK,UAAU,CAAA,oFACnD,YAAY,CAAC,OAAO,CAAE,SAAS,CAAE,UAAU,CAAC,kDAE5C,IAAI,KAAK,CAAI,IAAI,oCAAiC,iHAGtD,eAAI,IAAI,KAAK,8BAA8B,CAAA,4GAErC,YAAY,CAAC,eAAe,CAAE,CAAC,IAAI,CAAJ,IAAI,CAAC,CAAE,UAAU,CAAC,mHAEnD,eAAI,IAAI,KAAK,8BAA8B,CAAA,kMAQtD,CAAA,qBAEc,oBAAgB,IAAI,CAAE,EAAE,MAC/B,SAAS,CACT,IAAI,CAIA,QAAQ,gIALZ,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAC5B,IAAI,GAAG,EAAE,iCAEN,SAAS,CAAC,MAAM,+BACrB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC,CAAA,AACtB,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAC3B,QAAQ,CAAC,MAAM,oIAGd,YAAY,CAAC,QAAQ,CAAE,IAAI,CAAC,6CAEpC,EAAE,CAAC,IAAI,CAAC,CAAA,mGAER,EAAE,gBAAO,CAAA,qEAEZ","file":"ensureDir.js","sourcesContent":["import {request} from '../tools/smb2-forge'\r\nimport Bluebird from 'bluebird'\r\n\r\nconst requestAsync = Bluebird.promisify(request)\r\n\r\nconst ensureOneDir = async function (path, connection) {\r\n  try {\r\n    const fileOrDir = await requestAsync('open', {path}, connection)\r\n    if (fileOrDir.FileAttributes.readIntBE(0, 1) === 0x00000010) { // See http://download.microsoft.com/DOWNLOAD/9/5/E/95EF66AF-9026-4BB0-A41D-A4F81802D92C/[MS-FSCC].pdf Section 2.6\r\n      await requestAsync('close', fileOrDir, connection)\r\n    } else {\r\n      throw new Error(`${path} exists but is not a directory`)\r\n    }\r\n  } catch (err) {\r\n    if (err.code === 'STATUS_OBJECT_NAME_NOT_FOUND') {\r\n      try {\r\n        await requestAsync('create_folder', {path}, connection)\r\n      } catch (err) {\r\n        if (err.code !== 'STATUS_OBJECT_NAME_COLLISION') {\r\n          throw err\r\n        }\r\n      }\r\n    } else {\r\n      throw err\r\n    }\r\n  }\r\n}\r\n\r\nexport default async function (path, cb) {\r\n  const structure = path.split('\\\\')\r\n  const base = []\r\n  try {\r\n    while (structure.length) {\r\n      base.push(structure.shift())\r\n      const basePath = base.join('\\\\')\r\n      if (!basePath.length) {\r\n        continue\r\n      }\r\n      await ensureOneDir(basePath, this)\r\n    }\r\n    cb(null)\r\n  } catch (error) {\r\n    cb(error)\r\n  }\r\n}\r\n"]}